<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valeo BakÄ±m Deposu</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* SENÄ°N ORÄ°JÄ°NAL STÄ°LLERÄ°N - HÄ°Ã‡BÄ°R DEÄÄ°ÅÄ°KLÄ°K YAPILMADI */
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); width: 90%; max-width: 420px; text-align: center; border-top: 10px solid #99cc00; }
        .valeo-header { margin-bottom: 25px; }
        .valeo-title { color: #99cc00; font-size: 28px; font-weight: 800; margin: 0; text-transform: uppercase; letter-spacing: 1px; line-height: 1.2; }
        .valeo-subtitle { color: #666; font-size: 16px; margin-top: 5px; font-weight: 600; }
        input { width: 100%; padding: 14px; margin: 10px 0; border: 2px solid #eee; border-radius: 12px; box-sizing: border-box; font-size: 16px; outline: none; transition: 0.3s; }
        input:focus { border-color: #99cc00; background: #f9fff0; }
        button { background: #99cc00; color: white; border: none; padding: 15px; border-radius: 12px; cursor: pointer; width: 100%; font-size: 16px; font-weight: bold; margin-top: 5px; transition: 0.3s; }
        button:hover { background: #88b500; }
        #app-screen, #admin-screen { display: none; }
        .product-card { background: #fff; border: 1px solid #f0f0f0; margin-top: 12px; padding: 15px; border-radius: 12px; border-left: 6px solid #99cc00; text-align: left; cursor: pointer; }
        .sap-kodu { font-size: 14px; color: #99cc00; font-weight: 800; margin-bottom: 2px; }
        .malzeme-adi { font-weight: bold; color: #2c3e50; font-size: 17px; margin: 2px 0 8px 0; }
        .info-row { display: flex; justify-content: space-between; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #eee; font-size: 13px; color: #555; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 25px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center; }
        #welcome-msg { font-weight:bold; color:#99cc00; font-size: 14px; }
    </style>
</head>
<body>

<div id="login-screen" class="container">
    <div class="valeo-header">
        <div class="valeo-title">VALEO</div>
        <div class="valeo-subtitle">BakÄ±m Deposu</div>
    </div>
    <input type="text" id="user-input" placeholder="KullanÄ±cÄ± AdÄ±">
    <input type="password" id="pass-input" placeholder="Åifre">
    <button onclick="girisYap()">GÄ°RÄ°Å YAP</button>
    <p onclick="adminPanelAc()" style="margin-top:20px; font-size:11px; color:#ccc; cursor:pointer;">YÃ¶netici Paneli</p>
</div>

<div id="admin-screen" class="container">
    <div class="valeo-header">
        <div class="valeo-title">YÃ–NETÄ°CÄ°</div>
        <div class="valeo-subtitle">Personel Ekleme</div>
    </div>
    <input type="text" id="new-u" placeholder="Yeni KullanÄ±cÄ± AdÄ±">
    <input type="text" id="new-p" placeholder="Yeni Åifre">
    <button onclick="kullaniciKaydet()" style="background:#2c3e50;">SAYFA2'YE KAYDET</button>
    <button onclick="location.reload()" style="background:#6c757d; margin-top:10px;">GERÄ° DÃ–N</button>
</div>

<div id="app-screen" class="container">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding-bottom:10px; border-bottom:1px solid #eee;">
        <span id="welcome-msg"></span>
        <button onclick="cikisYap()" style="width:auto; padding:5px 12px; font-size:11px; background:#6c757d; margin:0;">Ã‡Ä±kÄ±ÅŸ</button>
    </div>
    <input type="text" id="search" placeholder="SAP veya Malzeme Ara..." oninput="aramaYap()">
    <div id="results" style="max-height: 420px; overflow-y: auto;"></div>
</div>

<div id="action-modal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color:#2c3e50;">Ä°ÅŸlem KaydÄ±</h3>
        <p id="modal-subtitle" style="color:#666; font-size:14px; margin-bottom:15px; font-weight:bold;"></p>
        <input type="number" id="islem-adet" placeholder="Miktar">
        <button id="btn-dus" style="background:#dc3545;" onclick="onayliKaydet('STOKTAN DÃœÅÃœM', this)">ğŸ“‰ Stoktan DÃ¼ÅŸ</button>
        <button id="btn-sip" style="background:#ffc107; color:black;" onclick="onayliKaydet('SÄ°PARÄ°Å TALEBÄ°', this)">ğŸ›’ SipariÅŸ Ver</button>
        <button onclick="modalKapat()" style="background:#eee; color:#333; margin-top:10px;">VazgeÃ§</button>
    </div>
</div>

<script>
    // GÃœNCELLEDÄ°ÄÄ°N YENÄ° LÄ°NK
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxGCCJo34saMWKeLiFKUaWZzZh3k4sIoAiRYZ_oV7rNPWtf60UaXJUKWIn0g27RRMsIRg/exec';
    const URUN_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTXdjBr4A8_FYBOe7FyxChJthgtaV1S57HxARC8MBsuxdGHywNAv7fLpxZrmK3yheolwBk26U-PSBzW/pub?gid=1489941403&single=true&output=csv';
    const USER_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTXdjBr4A8_FYBOe7FyxChJthgtaV1S57HxARC8MBsuxdGHywNAv7fLpxZrmK3yheolwBk26U-PSBzW/pub?gid=1584268931&single=true&output=csv';

    let urunler = [], kullanicilar = [], seciliUrun = null;

    window.onload = async () => {
        try {
            const [uRes, pRes] = await Promise.all([fetch(USER_URL), fetch(URUN_URL)]);
            const [uT, pT] = await Promise.all([uRes.text(), pRes.text()]);
            kullanicilar = XLSX.utils.sheet_to_json(XLSX.read(uT, {type:'string'}).Sheets.Sheet1);
            urunler = XLSX.utils.sheet_to_json(XLSX.read(pT, {type:'string'}).Sheets.Sheet1);
            
            const hatirla = localStorage.getItem('depoUser');
            if (hatirla) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-screen').style.display = 'block';
                document.getElementById('welcome-msg').innerText = "ğŸ‘¤ " + hatirla.toUpperCase();
            }
        } catch (e) { console.log("YÃ¼kleme HatasÄ±"); }
    };

    function girisYap() {
        const u = document.getElementById('user-input').value.trim().toLowerCase();
        const p = document.getElementById('pass-input').value.trim();
        const found = kullanicilar.find(row => (row["Kullanici"] || Object.values(row)[0]).toString().toLowerCase() === u && (row["Sifre"] || Object.values(row)[1]).toString() === p);
        if (found) {
            localStorage.setItem('depoUser', u);
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'block';
            document.getElementById('welcome-msg').innerText = "ğŸ‘¤ " + u.toUpperCase();
        } else { alert("HatalÄ± giriÅŸ!"); }
    }

    function adminPanelAc() {
        if(prompt("YÃ¶netici Åifresi:") === "1234") {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-screen').style.display = 'block';
        }
    }

    function kullaniciKaydet() {
        const ad = document.getElementById('new-u').value;
        const sif = document.getElementById('new-p').value;
        if(!ad || !sif) return alert("BoÅŸ bÄ±rakmayÄ±n!");
        
        fetch(SCRIPT_URL, { 
            method: 'POST', 
            mode: 'no-cors', 
            body: JSON.stringify({type: 'KULLANICI_EKLE', yeniAd: ad, yeniSifre: sif}) 
        });
        alert("Ä°ÅŸlem gÃ¶nderildi! Sayfa2'ye ekleniyor.");
        location.reload();
    }

    function cikisYap() { if(confirm("Ã‡Ä±kÄ±ÅŸ yapÄ±lsÄ±n mÄ±?")) { localStorage.removeItem('depoUser'); location.reload(); } }

    function aramaYap() {
        const q = document.getElementById('search').value.toLowerCase('tr');
        const resDiv = document.getElementById('results');
        resDiv.innerHTML = "";
        if(!q) return;
        urunler.filter(i => Object.values(i).some(v => String(v).toLowerCase('tr').includes(q))).slice(0, 15).forEach(i => {
            const v = Object.values(i);
            const card = document.createElement('div');
            card.className = 'product-card';
            card.onclick = () => { 
                seciliUrun = v; 
                document.getElementById('modal-subtitle').innerText = v[1]; 
                document.getElementById('action-modal').style.display = 'flex'; 
            };
            card.innerHTML = `<div class="sap-kodu">SAP: ${v[0]}</div><div class="malzeme-adi">${v[1]}</div><div class="info-row"><span>ğŸ“ ${v[2]}</span><span style="color:#99cc00; font-weight:bold;">ğŸ“¦ ${v[3]} ADET</span></div>`;
            resDiv.appendChild(card);
        });
    }

    function modalKapat() { 
        document.getElementById('action-modal').style.display = 'none'; 
        document.getElementById('islem-adet').value = ""; 
    }

    function onayliKaydet(islemTipi, btn) {
        const adet = document.getElementById('islem-adet').value;
        if(!adet || adet <= 0) return alert("Miktar girin!");
        if(confirm(islemTipi + " iÅŸlemini onaylÄ±yor musun?")) { veriyiKaydet(islemTipi, btn, adet); }
    }

    async function veriyiKaydet(islemTipi, btn, adet) {
        const originalText = btn.innerText;
        btn.innerText = "â³...";
        btn.disabled = true;
        const payload = { 
            sap: seciliUrun[0], ad: seciliUrun[1], adres: seciliUrun[2], 
            adet: adet, islem: islemTipi, kullanici: localStorage.getItem('depoUser') 
        };
        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) })
        .then(() => {
            alert("KayÄ±t BaÅŸarÄ±lÄ±!"); 
            btn.innerText = originalText;
            btn.disabled = false;
            modalKapat();
        }).catch(() => { alert("Hata!"); btn.disabled = false; });
    }
</script>
</body>
</html>
