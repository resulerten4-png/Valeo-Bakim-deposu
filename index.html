<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valeo BakÄ±m Depo YÃ¶netimi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --valeo-green: #99cc00;
            --valeo-dark: #2d2d2d;
            --bg-gray: #f4f7f6;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --white: #ffffff;
        }

        body { 
            font-family: 'Inter', 'Segoe UI', sans-serif; 
            background: var(--bg-gray); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
        }

        .container { 
            background: var(--white); 
            padding: 0; 
            border-radius: 16px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
            width: 95%; 
            max-width: 450px; 
            overflow: hidden;
            border-top: 8px solid var(--valeo-green);
        }

        /* BaÅŸlÄ±k AlanÄ± */
        .header {
            background: var(--valeo-dark);
            color: var(--white);
            padding: 25px 20px;
            text-align: center;
        }

        .valeo-title { font-size: 32px; font-weight: 900; letter-spacing: 2px; margin: 0; }
        .valeo-subtitle { font-size: 14px; opacity: 0.8; text-transform: uppercase; margin-top: 5px; font-weight: 300; }

        .content { padding: 25px; }

        input { 
            width: 100%; padding: 16px; margin: 12px 0; 
            border: 2px solid #e0e0e0; border-radius: 10px; 
            box-sizing: border-box; font-size: 16px; 
            transition: all 0.3s ease;
        }

        input:focus { border-color: var(--valeo-green); outline: none; box-shadow: 0 0 8px rgba(153,204,0,0.2); }

        button { 
            background: var(--valeo-green); color: var(--white); 
            border: none; padding: 18px; border-radius: 10px; 
            cursor: pointer; width: 100%; font-size: 16px; 
            font-weight: 700; text-transform: uppercase;
            transition: transform 0.1s, background 0.3s;
        }

        button:active { transform: scale(0.98); }
        button:hover { background: #86b300; }

        #app-screen, #admin-screen { display: none; }

        /* ÃœrÃ¼n KartlarÄ± */
        .product-card { 
            background: #fff; border: 1px solid #eee; 
            margin-top: 15px; padding: 18px; border-radius: 12px; 
            border-left: 8px solid var(--valeo-green);
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
            cursor: pointer;
        }

        .sap-kodu { font-size: 12px; color: var(--valeo-green); font-weight: 800; }
        .malzeme-adi { font-weight: 700; color: var(--valeo-dark); font-size: 18px; margin: 5px 0; }
        
        .info-row { 
            display: flex; justify-content: space-between; 
            margin-top: 12px; padding-top: 10px; 
            border-top: 1px solid #f5f5f5; font-size: 14px; color: #666; 
        }

        /* Modal */
        .modal { 
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; 
            width: 100%; height: 100%; background: rgba(0,0,0,0.7); 
            align-items: center; justify-content: center; backdrop-filter: blur(4px);
        }

        .modal-content { 
            background: white; padding: 30px; border-radius: 20px; 
            width: 85%; max-width: 380px; text-align: center; 
        }

        .welcome-bar {
            display: flex; justify-content: space-between; align-items: center;
            background: #f9f9f9; padding: 10px 15px; border-radius: 8px; margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div id="login-screen" class="container">
    <div class="header">
        <div class="valeo-title">VALEO</div>
        <div class="valeo-subtitle">BakÄ±m Stok PortalÄ±</div>
    </div>
    <div class="content">
        <input type="text" id="user-input" placeholder="KullanÄ±cÄ± AdÄ±">
        <input type="password" id="pass-input" placeholder="Åifre">
        <button onclick="girisYap()">SÄ°STEME GÄ°RÄ°Å</button>
        <p onclick="adminPanelAc()" style="margin-top:25px; font-size:11px; color:#aaa; cursor:pointer; letter-spacing:1px;">YÃ–NETÄ°CÄ° ERÄ°ÅÄ°MÄ°</p>
    </div>
</div>

<div id="admin-screen" class="container">
    <div class="header" style="background: #2c3e50;">
        <div class="valeo-title" style="font-size:24px;">YÃ–NETÄ°CÄ°</div>
        <div class="valeo-subtitle">Personel TanÄ±mlama</div>
    </div>
    <div class="content">
        <input type="text" id="new-u" placeholder="Yeni KullanÄ±cÄ± AdÄ±">
        <input type="text" id="new-p" placeholder="Yeni Åifre">
        <button onclick="kullaniciKaydet()" style="background:#2c3e50;">SAYFA2'YE KAYDET</button>
        <button onclick="location.reload()" style="background:#6c757d; margin-top:10px;">ANA SAYFA</button>
    </div>
</div>

<div id="app-screen" class="container">
    <div class="content">
        <div class="welcome-bar">
            <span id="welcome-msg" style="font-weight:700; color:var(--valeo-dark);"></span>
            <button onclick="cikisYap()" style="width:auto; padding:6px 15px; font-size:11px; background:#6c757d; margin:0;">GÃœVENLÄ° Ã‡IKIÅ</button>
        </div>
        
        <input type="text" id="search" placeholder="SAP Kodu veya Malzeme Ara..." oninput="aramaYap()">
        <div id="results" style="max-height: 450px; overflow-y: auto;"></div>
    </div>
</div>

<div id="action-modal" class="modal">
    <div class="modal-content">
        <div style="color:var(--valeo-green); font-size:40px; margin-bottom:10px;">ğŸ“¦</div>
        <h3 id="modal-subtitle" style="margin:0 0 20px 0; color:var(--valeo-dark); font-size:20px;"></h3>
        <input type="number" id="islem-adet" placeholder="Miktar Giriniz" style="text-align:center; font-size:20px; font-weight:700;">
        <button id="btn-dus" style="background:var(--danger);" onclick="onayliKaydet('STOKTAN DÃœÅÃœM', this)">ğŸ“‰ STOKTAN DÃœÅ</button>
        <button id="btn-sip" style="background:var(--warning); color:#000; margin-top:10px;" onclick="onayliKaydet('SÄ°PARÄ°Å TALEBÄ°', this)">ğŸ›’ SÄ°PARÄ°Å OLUÅTUR</button>
        <button onclick="modalKapat()" style="background:#f0f0f0; color:#666; margin-top:15px; font-size:13px;">Ä°PTAL</button>
    </div>
</div>

<script>
    // FORMÃœLLER VE LÄ°NKLER AYNI KALDI
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxGCCJo34saMWKeLiFKUaWZzZh3k4sIoAiRYZ_oV7rNPWtf60UaXJUKWIn0g27RRMsIRg/exec';
    const URUN_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTXdjBr4A8_FYBOe7FyxChJthgtaV1S57HxARC8MBsuxdGHywNAv7fLpxZrmK3yheolwBk26U-PSBzW/pub?gid=1489941403&single=true&output=csv';
    const USER_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTXdjBr4A8_FYBOe7FyxChJthgtaV1S57HxARC8MBsuxdGHywNAv7fLpxZrmK3yheolwBk26U-PSBzW/pub?gid=1584268931&single=true&output=csv';

    let urunler = [], kullanicilar = [], seciliUrun = null;

    window.onload = async () => {
        try {
            const [uRes, pRes] = await Promise.all([fetch(USER_URL), fetch(URUN_URL)]);
            const [uT, pT] = await Promise.all([uRes.text(), pRes.text()]);
            kullanicilar = XLSX.utils.sheet_to_json(XLSX.read(uT, {type:'string'}).Sheets.Sheet1);
            urunler = XLSX.utils.sheet_to_json(XLSX.read(pT, {type:'string'}).Sheets.Sheet1);
            const hatirla = localStorage.getItem('depoUser');
            if (hatirla) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-screen').style.display = 'block';
                document.getElementById('welcome-msg').innerText = "PERSONEL: " + hatirla.toUpperCase();
            }
        } catch (e) { console.log("Hata"); }
    };

    function girisYap() {
        const u = document.getElementById('user-input').value.trim().toLowerCase();
        const p = document.getElementById('pass-input').value.trim();
        const found = kullanicilar.find(row => (row["Kullanici"] || Object.values(row)[0]).toString().toLowerCase() === u && (row["Sifre"] || Object.values(row)[1]).toString() === p);
        if (found) {
            localStorage.setItem('depoUser', u);
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'block';
            document.getElementById('welcome-msg').innerText = "PERSONEL: " + u.toUpperCase();
        } else { alert("GÄ°RÄ°Å YETKÄ°SÄ° REDDEDÄ°LDÄ°!"); }
    }

    function adminPanelAc() {
        if(prompt("YÃ–NETÄ°CÄ° ÅÄ°FRESÄ°:") === "1234") {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-screen').style.display = 'block';
        }
    }

    function kullaniciKaydet() {
        const ad = document.getElementById('new-u').value;
        const sif = document.getElementById('new-p').value;
        if(!ad || !sif) return alert("EKSÄ°K ALAN!");
        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({type: 'KULLANICI_EKLE', yeniAd: ad, yeniSifre: sif}) });
        alert("PERSONEL KAYDI GÃ–NDERÄ°LDÄ°.");
        location.reload();
    }

    function cikisYap() { if(confirm("OTURUM KAPATILSIN MI?")) { localStorage.removeItem('depoUser'); location.reload(); } }

    function aramaYap() {
        const q = document.getElementById('search').value.toLowerCase('tr');
        const resDiv = document.getElementById('results');
        resDiv.innerHTML = "";
        if(!q) return;
        urunler.filter(i => Object.values(i).some(v => String(v).toLowerCase('tr').includes(q))).slice(0, 15).forEach(i => {
            const v = Object.values(i);
            const card = document.createElement('div');
            card.className = 'product-card';
            card.onclick = () => { 
                seciliUrun = v; 
                document.getElementById('modal-subtitle').innerText = v[1]; 
                document.getElementById('action-modal').style.display = 'flex'; 
            };
            card.innerHTML = `<div class="sap-kodu">SAP: ${v[0]}</div><div class="malzeme-adi">${v[1]}</div><div class="info-row"><span>ğŸ“ KONUM: ${v[2]}</span><span style="color:var(--valeo-green); font-weight:900;">ğŸ“¦ STOK: ${v[3]}</span></div>`;
            resDiv.appendChild(card);
        });
    }

    function modalKapat() { document.getElementById('action-modal').style.display = 'none'; document.getElementById('islem-adet').value = ""; }

    function onayliKaydet(islemTipi, btn) {
        const adet = document.getElementById('islem-adet').value;
        if(!adet || adet <= 0) return alert("GEÃ‡ERLÄ° MÄ°KTAR GÄ°RÄ°N!");
        if(confirm(islemTipi + " Ä°ÅLEMÄ°NÄ° ONAYLIYOR MUSUNUZ?")) { veriyiKaydet(islemTipi, btn, adet); }
    }

    async function veriyiKaydet(islemTipi, btn, adet) {
        const originalText = btn.innerText;
        btn.innerText = "KAYDEDÄ°LÄ°YOR...";
        btn.disabled = true;
        const payload = { 
            sap: seciliUrun[0], ad: seciliUrun[1], adres: seciliUrun[2], 
            adet: adet, islem: islemTipi, kullanici: localStorage.getItem('depoUser') 
        };
        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) })
        .then(() => {
            alert("Ä°ÅLEM BAÅARIYLA KAYDEDÄ°LDÄ°."); 
            btn.innerText = originalText; btn.disabled = false; modalKapat();
        }).catch(() => { alert("BAÄLANTI HATASI!"); btn.disabled = false; });
    }
</script>
</body>
</html>
